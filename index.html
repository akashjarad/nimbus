<!DOCTYPE html>
<html>

  <head>
    <title>Nimbus</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <!-- Underscore and other utilities -->
    <script src="js/underscore.js"></script>

    <!-- Isomerjs and libraries -->
    <script src="js/isomer.js"></script>

    <!-- Objects -->
    <script src="js/objects/ec2.js"></script>

    <!-- Reset CSS styles -->
    <link href="css/reset.css" rel="stylesheet">

  </head>
  <body>
    <canvas id="canvas" width="1000" height="700"></canvas>
    <script>
      // Cruft to make the canvas fill the screen
      var ctx = document.getElementById("canvas");
      if (window.innerWidth > 1000 && window.innerHeight > 700) {
        ctx.width  = window.innerWidth;
        ctx.height = window.innerHeight;
      }

      /**
       * Let the Isomer hacks begin!
       */

      /**
       * Sets the color of a path
       */
      Isomer.Path.prototype.setColor = function (color) {
        this.color = color;
      };

      /**
       * Sets the color of a shape
       */
      Isomer.Shape.prototype.setColor = function (color) {
        var paths = this.paths;
        for (i = 0; i < paths.length; i++) {
          paths[i].color = color;
        }
        this.paths = paths
      }

      /**
       * Build out a collection object which can contain lots of objects
       */

      function Object3D(shapes) {
         if (Object.prototype.toString.call(shapes) === '[object Array]') {
          this.items = shapes;
        } else {
          this.items = Array.prototype.slice.call(arguments);
        }
      }

      Object3D.prototype.push = function (item, color) {
        if (Object.prototype.toString.call(item) == '[object Array]') {
          for (var i = 0; i < item.length; i++) {
            this.push(item[i], color);
          }
        } else {
          if (color instanceof Isomer.Color) {
            item.setColor(color);
          }
          this.items.push(item);
        }
      }

      /**
       * Translates a given object
       *
       * Simply a forward to Shape#translate
       */
      Object3D.prototype.translate = function () {
        var args = arguments;
        console.log(args)
        return new Object3D(this.items.map(function (shape) {
          return shape.translate.apply(shape, args);
        }));
      }

      Isomer.Object3D = Object3D;


      /**
       * Kick off our diagrams
       *
       * Generated with Isomer
       * http://jdan.github.com/isomer
       */

      /* Create an Isomer instance with our canvas */
      var iso = new Isomer(document.getElementById("canvas"));

      /* Some convenient renames */
      var Point = Isomer.Point;
      var Path = Isomer.Path;
      var Shape = Isomer.Shape;
      var Color = Isomer.Color;

      function scene() {

        /* Plane to infinity */
        for (x = -100; x < 100; x++) {
          iso.add(new Path([
            new Point(x, -100, 0),
            new Point(x, 100, 0),
            new Point(x, -100, 0)
          ]), new Color(50, 50, 50, 0.02));
        }
        for (y = -100; y < 100; y++) {
          iso.add(new Path([
            new Point(-100, y, 0),
            new Point(100, y, 0),
            new Point(-100, y, 0)
          ]), new Color(50, 50, 50, 0.02));
        }

        /* Render S3 at back */
        iso.add(S3(new Point(2.2, 1.75, 0)));

        /* Add some instances */
        iso.add(EC2Instance(new Point(0, 3, 0), 'large'));
        iso.add(EC2Instance(new Point(0, 1.5, 0), 'medium'));
        iso.add(EC2Instance(new Point(0, 0, 0), 'small'));

        /* Other Examples */
        iso.add(ELB(new Point(3, 0.5, 0)));

      }

      scene()
      // setInterval(scene, 1000 / 30);

    </script>
  </body>
</html>